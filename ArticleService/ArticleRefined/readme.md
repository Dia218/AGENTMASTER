# 작성 정보
- 20230817
- 김준우
    - Article에 대한 내용을 추가했습니다.
    - ArticleBundle에 대한 내용을 추가했습니다. 

- 230820
- 김준우
- 내용
    - Article에 대한 내용을 수정했습니다.
    - ArticleBundle에 대한 내용을 수정했습니다. 
    - DatabaseHandler에 대한 내용을 추가했습니다. 

- 230820
- 김준우
    - ArticleBundle에 대한 내용을 수정했습니다. 

# 개요
## Article
기사 하나에 대응하는 필요한 정보가 담긴 객체입니다.

### 멤버변수
- link: 기사 웹페이지 링크 
- title: 기사 제목(헤드라인)
- reporter: 기사 작성자(기자)
    - <한국인 이름> "기자" 의 형식을 가지고 있습니다. 여러명의 경우 쉼표와 띄어쓰기 하나로 구분합니다. 
- company: 신문사
- body: 기사 본문
- summary: 기사 요약문
- first_pub: 최초 게시 날짜 및 시간
    - yyyy-MM-dd hh:mm:ss의 형식을 가지고 있습니다. 연-월-일 시:분:초의 형식이고 24시간을 사용합니다. KST 로컬시간입니다. 
- last_pub: 최근 수정 날짜 및 시간
    - yyyy-MM-dd hh:mm:ss의 형식을 가지고 있습니다. 연-월-일 시:분:초의 형식이고 24시간을 사용합니다. KST 로컬시간입니다. 

### 주의
1. Article 객체를 생성하기위해서는 매개변수 link에 반드시 그 기사 웹페이지 링크를 넘겨주어야 합니다. 
2. **함수 명이 언더바로 시작하는 경우, 사용자 코드는 함부러 함수를 호출해선 안됩니다. 이 경우 정상작동을 보증할 수 없습니다.**

### 상세
`__init__`
Article 객체를 생성합니다. 매개변수로 link를 반드시 넘겨야 하며, 나머지 매개변수는 선택적입니다. 

`fill_attributes`
멤버 변수를 채웁니다. 즉, 주어진 link에서 기사 정보를 크롤링합니다. 

`_parse_...`
...에 해당하는 멤버 변수에 내용을 채웁니다. 

`set_summary`
summary 멤버 변수에 내용을 채웁니다. 

`to_dict`
파이썬의 딕셔너리 형태로 내용을 반환합니다. 이때 모든 멤버변수 값은 문자열(str)로 반환합니다. 

`is_filled`
크롤링이 수행되었다면 참, 제대로 수행되지 않았다면 거짓을 반환합니다. 제목, 최초 게시 날짜 및 시간, 신문사 세 멤버 변수가 모두 채워지지 않으면 크롤링이 수행되지 않았다고 판단합니다. 그 외 나머지 멤버 변수는 판단에 영향을 주지 않습니다. 

## ArticleBundle
네이버의 섹션별 웹 페이지에서 기사를 크롤링 했을 때, 다수의 기사 (기사 묶음)에 대응하는 객체입니다.

### 멤버변수
- attributes: 멤버 변수의 이름을 담는 튜플. 
- post_work_attributes: 멤버 변수중, 후처리가 계속 필요한 멤버 변수를 따로 저장
- section: 기사의 섹션
- date: 기사들의 게시 날짜
- last_crawled_page: 제일 마지막으로 기사가 크롤링된 페이지
- aggregated: 크롤링된 기사

### 왜 20개인가? 
섹션별 웹 페이지는 다수의 기사(정확하게 20개; 20230817 기준)를 포함하고 있어서 한번 웹페이지를 불러왔을 때 존재하는 모든 기사를 크롤링하는 것이 훨씬 효율적입니다. 20개 단위가 아닌 그 외의 단위로 기사를 크롤링하는 경우 기사 크롤링이 어디서 멈추었는지를 계속 추적하고, 이어 크롤링하는 과정에서는 그 지점에 이어 크롤링해야 하기 때문입니다.

### 왜 따로 클래스가 필요한가? 
섹션별 웹 페이지의 URL은 날짜, 페이지, 섹션을 요구합니다. 이러한 메타 정보들은 기사와 함께 저장하는 편이 프로그램 단순화에 유리합니다. 

### 주의
1. 크롤링 섹션(뉴스 분류)는 "정치", "경제", "사회", "세계" 중 하나만 허용합니다. 
2. ArticleBundle 객체의 크롤링 날짜를 런타임으로 바꾸는 기능은 제공하지 않습니다. 임의로 사용자가 바꾸는 경우 정상작동, 체계적 데이터 관리를 보증하지 않습니다.
3. **함수 명이 언더바로 시작하는 경우, 사용자 코드는 함부러 함수를 호출해선 안됩니다. 이 경우 정상작동을 보증할 수 없습니다.**
4. **ArticleBundle 모듈 파일에 작성되었으나 상세에 언급되지 않은 변수를 임의로 조작하는 경우에는 정상 작동을 보증할 수 없습니다. 자세한 설명은 내부 상태란을 참조하십시오.**

### 상세
`__init__`
ArticleBundle 객체를 생성합니다. 이때, 매개변수를 전달하여 기사를 크롤링할 섹션과 날짜를 설정해야 합니다. 날짜는 시스템 설정 날짜를 기준으로 음수면 이전 날짜; 기왕일, 양수면 이후 날짜; 향후일을 설정할 수 있습니다. 설정하지 않는 경우 오늘이 크롤링 날짜로 설정됩니다. 생성 이후 런타임으로 날짜를 바꿀 수 있는 방법은 존재하지 않습니다. 

`aggregate`
게시된 기사의 링크를 모아옵니다. 
narticleLB는 크롤링할 기사 수의 하한을 의미하며, 코드는 자동으로 narticleLB보다 큰 최소의 20의 배수 만큼 크롤링합니다. 20의 배수인 이유는 상기 '왜 20개인가?'를 읽어보시길 권합니다. 

`_parse_links`
링크를 크롤링합니다. 

`fetch_articles`
각 기사의 링크에 접속하여 기사의 정보를 모아옵니다. 

`_find_non_filled_index`
기사의 일부는 정보까지 수집이 완료되었으나, 일부는 그렇지 아니한 경우, 정보가 수집되지 않은 기사의 위치를 찾습니다. 

`to_dict`
딕셔너리 형태로 반환합니다. 

`save_to_json`
json 파일에 저장합니다. json 파일의 위치는 코드가 존재하는 디렉토리에 생성되고, 이름은 섹션_날짜.json 입니다. 

### 내부 상태
`allowed_sections`
크롤링이 허용된 뉴스 분류를 정의합니다. 이 외에는 장기간에 걸친 보도가 의미가 없는 분류이므로 서비스에 적절한 뉴스 분류가 아닙니다.

`section_to_code`
네이버 뉴스(news.naver.com)의 url에서 사용하는 분류 코드로, 각 섹션에 대한 분류 코드를 의미합니다. sid1의 value가 됩니다. 
- url 코드가 바뀐 경우 바뀐 url에 맞추어 변경하십시오. 

`section_to_general_code`
네이버 뉴스(news.naver.com)의 url에서 사용하는 분류 코드로, 각 섹션에 대한 '일반 뉴스'란 분류 코드를 의미합니다. sid2의 value가 됩니다. 
- url 코드가 바뀐 경우 바뀐 url에 맞추어 변경하십시오. 

`header`
네이버 뉴스에서 크롤링을 수행하기 위해 http 요청에 담는 헤더입니다. 

`N_ARTICLES_PER_PAGE`
2023.08.20 기준, 한 웹 페이지에 담긴 기사 수를 의미합니다.
- 네이버 뉴스 페이지의 디자인이 변경된 경우 기사 수에 맞추어 변경하십시오. 

### 예시
```python
ab = AricleBundle("경제") # 시스템 날짜를 기준으로 경제란을 크롤링하도록 설정. 
ab.aggregate(LB=33) # 뉴스 40개의 링크를 크롤링.
ab.fetch_articles() # 뉴스 40개의 각 정보를 모두 채움. 

```
## DatabaseHandler
postgresql을 사용하는 데이터베이스에의 연결과 조작을 관장하는 객체입니다. 

프로그램과 데이터베이스를 연동할 때, 프로그램 코드에 DB 프로그램 포트, 비밀번호와 같은 민감 정보를 포함하지 않도록, **연동에 필요한 모든 정보는 json 파일에서 불러오게 강제합니다.** 

json 파일을 작성한 후, DatabaseHandler 객체를 생성할 때, 매개변수로 json 파일의 경로를 넘겨주어야 합니다. 

### 주의
1. json 파일을 작성한 후, DatabaseHandler 객체를 생성할 때, 매개변수로 json 파일의 경로를 넘겨주어야 합니다. 
2. json 파일에는 다섯가지의 key("host", "user", "password", "dbname", "port")를 포함할 수 있습니다. 이 외의 key는 무시됩니다. 
3. 키를 포함하지 않거나, null로 지정할 수 있습니다. 그 값이 null로 지정된 connection string 매개변수는 무시됩니다. 
4. **함수 명이 언더바로 시작하는 경우, 사용자 코드는 함부러 함수를 호출해선 안됩니다. 이 경우 정상작동을 보증할 수 없습니다.**

### 예시
#### json 파일
```json
{
    "host": "string123",
    "user": "string123",
    "password": "string123",
    "dbname": "string123",
    "port": "string123"
}
```

#### 사용자 코드
```python
new_connection = DatabaseHandler("./conn_config.json") # 연동을 자동 수행합니다. 
new_connection.insert(tbname="weather", attributes=("city", "temp", "prec", "date"), values=("Suwon", "24.5", "0.4", "2023-08-20")) # DB 연산
```

### 상세
`__init__`
데이터베이스 핸들러 객체를 생성합니다. 매개변수로 설정 사항이 담긴 json 파일의 경로를 문자열로써 전달해야 합니다. 

`_load_config`
json 파일에서 설정 변수의 값을 불러옵니다. 

`_assemble_connection_string`
불러온 설정 변수 값으로 connection string을 만듧니다. 

`_connect`
DB와 연동합니다. 
